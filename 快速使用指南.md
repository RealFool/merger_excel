# Excel多表合并工具 - 快速使用指南

## 🎯 功能概述

本工具专为解决企业中常见的Excel表格合并难题而设计，能够智能识别语义相同但表述不同的字段名，实现异构表格的秒级对齐。

### 典型应用场景
- 多分公司销售报表合并
- 不同部门数据统一
- 历史数据整合
- 供应商数据标准化

### 智能匹配示例
```
"订单ID" ← ["订单ID", "ID_订单", "订单编号", "销售单号", "order_id"]
"客户名称" ← ["客户名称", "客户名", "客户全称", "公司名称", "customer_name"]
"产品名称" ← ["产品名称", "商品名称", "产品", "商品", "product_name"]
```

## 🚀 快速开始

### 1. 环境准备
```bash
# 安装依赖
pip install -r requirements_excel_merger.txt
```

### 2. 运行演示
```bash
# 完整演示（自动创建示例文件并合并）
python excel_merger_demo.py --demo

# 仅创建示例文件
python excel_merger_demo.py --create-sample
```

### 3. 合并自己的文件
```bash
# 合并指定的Excel文件
python excel_merger_demo.py --files 文件1.xlsx 文件2.xlsx 文件3.xlsx --output ./my_output

# 使用增强版（支持API）
python excel_merger_enhanced.py --files 文件1.xlsx 文件2.xlsx --config config_excel_merger.json
```

## 📊 工具版本对比

| 功能特性 | 演示版 (demo) | 增强版 (enhanced) |
|---------|---------------|------------------|
| 模糊匹配 | ✅ | ✅ |
| 预定义模式 | ✅ | ✅ |
| AI智能匹配 | ❌ | ✅ (需API密钥) |
| 批量处理 | ✅ | ✅ |
| 详细报告 | ✅ | ✅ |
| 配置文件 | ❌ | ✅ |
| 缓存机制 | ❌ | ✅ |

## 🔧 配置说明

### API配置（增强版）
编辑 `config_excel_merger.json`：
```json
{
  "deepseek_api": {
    "api_key": "your-api-key-here",
    "base_url": "https://api.deepseek.com",
    "model": "deepseek-chat"
  }
}
```

### 字段匹配阈值调整
```json
{
  "field_matching": {
    "similarity_threshold": 0.75,
    "use_ai_analysis": true,
    "fallback_to_fuzzy": true
  }
}
```

## 📁 输出文件说明

运行完成后，会在输出目录生成以下文件：

1. **合并结果_时间戳.xlsx** - 最终合并的Excel文件
2. **合并报告_时间戳.json** - 详细的合并统计和分析报告
3. **字段映射_时间戳.json** - 字段映射关系记录

## 🎯 最佳实践

### 1. 文件准备
- 确保Excel文件格式正确（.xlsx 或 .xls）
- 第一行应为字段名（表头）
- 避免合并单元格
- 数据类型保持一致

### 2. 字段命名建议
- 使用有意义的字段名
- 避免特殊字符和空格
- 保持命名的一致性

### 3. 性能优化
- 大文件建议分批处理
- 定期清理缓存文件
- 使用SSD存储提升读写速度

## ❓ 常见问题

### Q: 为什么某些字段没有被正确匹配？
A: 可能原因：
- 字段名差异过大，超出相似度阈值
- 需要添加自定义匹配模式
- 建议检查字段映射报告，手动调整

### Q: 如何处理重复数据？
A: 工具会自动检测并移除完全重复的行，保留第一次出现的记录。

### Q: 支持哪些Excel格式？
A: 支持 .xlsx 和 .xls 格式，推荐使用 .xlsx。

### Q: 如何自定义字段匹配规则？
A: 编辑配置文件中的 `common_field_patterns` 部分，添加自定义匹配模式。

## 🔗 相关文件

- `excel_merger_demo.py` - 演示版主程序（无需API）
- `excel_merger_enhanced.py` - 增强版主程序（支持AI）
- `config_excel_merger.json` - 配置文件
- `requirements_excel_merger.txt` - 依赖包列表
- `README_Excel_Merger.md` - 详细技术文档

## 📞 技术支持

如遇到问题，请检查：
1. 日志文件 `excel_merger_demo.log`
2. 合并报告中的错误信息
3. 确认文件路径和权限

---

💡 **提示**: 首次使用建议先运行演示模式熟悉功能，然后再处理实际业务数据。